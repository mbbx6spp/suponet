

  
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html">
  <link href="/images/favicon.ico" rel="shortcut icon">
  <meta content="width=device-width, minimum-scale=1.0, maximum-scale=1.5" name="viewport">
  <title>Susan Potter: Anonymous Classes: Java's Synthetic Closure</title>
  <link rel="stylesheet" type="text/css" href="/stylesheets/reset.css">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="/stylesheets/styles.css">
  <link rel="stylesheet" type="text/css" href="/stylesheets/coderay.css">


  
    <header>
  <div class="container">
    <a href="/">
      <img alt="Susan Potter" height="30" src="/images/logo.png" width="128">
    </a>
    <nav>
      <a href="/about/">About</a>
      <a href="/resume/">Resume</a>
      <a href="/portfolio/">Portfolio</a>
      <a href="/talks/">Talks</a>
      <a href="/contact/">Contact</a>
      <a target="_blank" id="twitter" class="icon" href="https://twitter.com/SusanPotter"><img src="/images/twitter.png" height="30" width="30" alt="@SusanPotter's Twitter feed"></a>
      <a target="_blank" id="linked" class="icon" href="https://www.linkedin.com/in/susanpotter"><img src="/images/linkedin.png" height="30" width="30" alt="Susan Potter's LinkedIn profile"></a>
      <a target="_blank" id="github" class="icon" href="https://github.com/mbbx6spp"><img src="/images/github.png" height="30" width="30" alt="Susan Potter's GitHub open source code repository profile"></a>
    </nav>
  </div>
</header>


    <div class="text post sidebar">
      <aside class=".hidden-xs .hidden-sm">
        <ul class="share-buttons">
          <li class="twitter"><a href="https://twitter.com/share" class="twitter-share-button" data-count="vertical" data-via="SusanPotter">Tweet</a></li>
          <li class="plusone">
          <li class="linked">
<script type="text/javascript" src="https://platform.linkedin.com/in.js"></script><script type="in/share" data-counter="top"></script>
</li>
        </ul>
      </aside>
      <section>
        <article>
          <h1 class="banner">
            Software Development Blog <small>(formerly called 'Snakes, Gems &amp; Coffee')</small>
            <span class="description">
              A technical blog with articles on a number of topics from Erlang, Ruby idioms, Javascript,
              semantic web, Rails tips, graph databases, distributed systems.
            </span>
          </h1>
          
          <h2>Anonymous Classes: Java's Synthetic Closure</h2>
          <h5 class="time">2007-08-21 22:50:00 -0500</h5>
          I've been meaning to write this blog post since late last year when I revisited the Java world after a hiatus of adventures in the Ruby and Python worlds.

When I was a Java advocate (many moons ago it seems now), I really didn't appreciate the true beauty that is anonymous classes.  I saw them as ugly and reducing code readability.  Syntactically I still agree with that assessment, but conceptually I couldn't disagree more now.

When revisiting Java last year for a client, I found myself really missing blocks from the Ruby world.  The following common snippet of code in Ruby passes a block to a method:
%pre
  %code
    :preserve
      
        connection = Net::HTTP.new
        connection.use_ssl = true if ssl?
        connection.start do |connection|
          request = yield connection if block_given?
          request.basic_auth(@login, @password) if require_auth
          response = connection.request(request, body)
          handle_rest_response(response)
          response
        end
[This code is taken from the
%a{:href =&gt; "http://twitter4r.rubyforge.org/"} Twitter4R
project and is slightly
= succeed ".]" do
  %i paraphrased
What we are doing here is wrapping a block within a begin/end API construct.  So the previous snippet of code is effectively the same as (and in fact this is the way the above gets executed):
%pre
  %code
    :preserve
      
        connection = Net::HTTP.new
        connection.use_ssl = true if ssl?
        connection.open
        request = yield connection if block_given?
        request.basic_auth(@login, @password) if require_auth
        response = connection.request(request, body)
        handle_rest_response(response)
        connection.close
        response
Why is the first so much better from a code maintainability and readability perspective?  In my view the main benefits include (but are not limited to):
%ul
  %li
    Passing in a block ensures we close the connection (as in the above code example).  If we forgot to "end" the block in the first snippet we would get a
    %tt SyntaxError
    in Ruby which would remind us to close the block (and thus connection implicitly).  Which means less likely to introduce defects related to not closing connections unlike second code example.
  %li Putting the code to be executed passed in with a block improves code readability and in my view that is always a good thing.  It is more obvious to fellow developers what is going on.
Now in Java we can't simulate the code above in Java syntax...or can we?

I suggest with a few more
%tt {}
and
%tt ()
and
%tt ;
we can accomplish the same as above.  And if we cover our eyes with our hands and squint through the gaps in our fingers, we might be happy with the way it looks (OK, it is ugly, but this is the world of Java people!).

Below is an example of a similar technique as the Ruby example above, but this time in Java and related to database transaction (specifically in Hibernate3 below):
%pre
  %code
    :preserve
      
      // In PersistenceExecutionResult.java we define the following....
      public class PersistenceExecutionResult {
        private Object result;
        public PersistenceExecutionResult(Object theResult) {
          result = theResult;
        }
      
        public Object getResult() { return result; }
        public void setResult(Object theResult) { result = theResult; }
      }
      
      // Now in PersistenceExecutor.java we define....
      public interface PersistenceExecutor {
        public abstract PersistenceExecutionResult execute() throws Exception;
      }
      
      // Now in BaseDAO.java we have the following....
      public class BaseDAO {
        public Long create(BaseObject persistableObject) throws Exception {
          final Session session = ....; // get session somehow - irrelevant to demonstration of synthetic closures in Java
          return (Long)executeTransaction(session, new PersistenceExecutor() {
            public PersistenceExecutionResult execute() {
              return new PersistenceExecutionResult(session.save(persistableObject);
            }
          });
        }
      
        // other stuff, but just adds noise to example.
      
        protected ExecutionResult executeTransaction(Session session, PersistenceExecutor executor)
          throws Exception {
          Transaction tx = null;
          PersistenceExecutionResult result = null;
          try  {
            tx = session.beginTransaction();
            result = executor.execute();
            tx.commit();
          } catch (Exception e) {
            if (null != tx) tx.rollback();
          } finally {
            session.close();
          }
          return result;
        }
      }
Now what on earth is going on?  Anyone?  Well I will explain in a subsequent posting and compare it to the equivalent code without using anonymous classes to wrap begin/end API constructs.  Right now I am too tired and lazy, but I will explain soon, fear not.
%b Notes:
the above works with JDK 1.4 because when I wrote this it had to be 1.4 compliant (therefore fancy generic interface definition to DAO was not possible).  I have only used JDK 1.5 (aka 5) and not 6.  Is there a nicer way of doing this in 6?

        </article>
      </section>
    </div>
    <footer>
  <p>
    Copyright Â© 2006-2018 <a href="//susanpotter.net">Susan Potter</a>.
  </p>
  <p>
    This website is developed by <a href="//susanpotter.net">Susan Potter</a>.
  </p>
  <div id="rights">
    <a href="//susanpotter.net">Susan Potter</a> reserves all rights to the copy and intellectual rights that are presented on this website as original material to <a href="//susanpotter.net">Susan Potter</a>.
    Links: <a href="//susanpotter.net/resume/software-engineering/">Software Engineer Extraordinaire</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Software Developer Extraordinaire</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Software Engineer</a>,
           <a href="//susanpotter.net/resume/architect/">Application architect/</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Ruby Software Engineer</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Ruby Engineer</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Ruby on Rails Engineer</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Ruby on Rails Software Engineer</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Software Developer</a>,
           <a href="//susanpotter.net/resume/architect/">Software architect/</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Hedge Fund Software Engineer</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Hedge Fund Software Developer</a>,
           <a href="//susanpotter.net/">Web Services Software Engineer</a>,
           <a href="//susanpotter.net/">Web Services Software Developer</a>,
           <a href="//susanpotter.net/">Web Services Engineer</a>,
           <a href="//susanpotter.net/">Web Services Developer</a>,
           <a href="//susanpotter.net/resume/restful-design/">REST Software Engineer</a>,
           <a href="//susanpotter.net/resume/restful-design/">REST Software Developer</a>,
           <a href="//susanpotter.net/resume/restful-design/">Resource Oriented architect/ure</a>,
  </div>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-837842-1', 'auto');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');
  </script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.6/jquery.min.js"></script>
  
  
  <script async="async" defer src="/javascripts/app.js"></script>
  <script>
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>
</footer>

    <script type="text/javascript">
      (function($) {
        var btns = $('.share-buttons .plusone').html('<g:plusone size="tall"></g:plusone>');
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })(jQuery);
    </script>
    <!-- Place this tag just before your close body tag -->
  

