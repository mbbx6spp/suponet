

  
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link href="/images/favicon.ico" rel="shortcut icon">
  <meta content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" name="viewport">
  <title>Susan Potter: RSpec "should_yield"?</title>
  <link rel="stylesheet" type="text/css" href="/stylesheets/reset.css">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="/stylesheets/styles.css">
  <link rel="stylesheet" type="text/css" href="/stylesheets/coderay.css">


  
    <header>
  <div class="container">
    <a href="/">
      <img alt="Susan Potter" height="30" src="/images/logo.png" width="128">
    </a>
    <nav>
      <a href="/about/">About</a>
      <a href="/resume/">Resume</a>
      <a href="/portfolio/">Portfolio</a>
      <a href="/talks/">Talks</a>
      <a href="/contact/">Contact</a>
      <a target="_blank" id="twitter" class="icon" href="https://twitter.com/SusanPotter"><img src="/images/twitter.png" height="30" width="30" alt="@SusanPotter's Twitter feed"></a>
      <a target="_blank" id="linked" class="icon" href="https://www.linkedin.com/in/susanpotter"><img src="/images/linkedin.png" height="30" width="30" alt="Susan Potter's LinkedIn profile"></a>
      <a target="_blank" id="github" class="icon" href="https://github.com/mbbx6spp"><img src="/images/github.png" height="30" width="30" alt="Susan Potter's GitHub open source code repository profile"></a>
    </nav>
  </div>
</header>


    <div class="text post sidebar">
      <aside class=".hidden-xs .hidden-sm">
        <ul class="share-buttons">
          <li class="twitter"><a href="https://twitter.com/share" class="twitter-share-button" data-count="vertical" data-via="SusanPotter">Tweet</a></li>
          <li class="plusone">
          <li class="linked">
<script type="text/javascript" src="https://platform.linkedin.com/in.js"></script><script type="in/share" data-counter="top"></script>
</li>
        </ul>
      </aside>
      <section>
        <article>
          <h1 class="banner">
            Software Development Blog <small>(formerly called 'Snakes, Gems &amp; Coffee')</small>
            <span class="description">
              A technical blog with articles on a number of topics from Erlang, Ruby idioms, Javascript,
              semantic web, Rails tips, graph databases, distributed systems.
            </span>
          </h1>
          
          <h2>RSpec "should_yield"?</h2>
          <h5 class="time">2007-07-01 16:51:00 -0500</h5>
          While writing some specifications for the 0.2.0 version of
%a{:href =&gt; "http://twitter4r.rubyforge.org/"} Twitter4R
(soon to be released - honestly), I realized there was no clean way to do
= succeed "," do
  %tt #should_yield
so I thought I would offer my suggestion for the developers of RSpec to critique as appropriate.

Assume we have a method signature that takes a block and
%b should
yield an object to the block given (if one is given).  Something like the following:
%pre
  :preserve
    
    class Client
      class &lt;&lt; self
        def configure(&amp;block)
          # implementation of Client.configure
        end
        # rest of class methods for Client class go here...
      end
      # rest of instance methods for Client class go here....
    end
Where usage for the
%code Client.configure
method should look something like the following:
%pre
  :preserve
    
    Client.configure do |conf|
      conf.proxy_host = 'myproxyhost'
      conf.proxy_port = 8080
      conf.proxy_user = 'me'
      conf.proxy_pass = 'mypass'
    end
The object yielded to the block given is an instance of
%code Config
which has settable attributes:
= succeed "," do
  %code proxy_host
= succeed "," do
  %code proxy_port
= succeed "," do
  %code proxy_user
= succeed "." do
  %code proxy_pass
The question is how do we write RSpec specifications for this?

First we need to define what we want to specify for the expected behavior.  My first attempt is to describe (in English) that:
%ul
  %li
    %code Client.configure
    should
    %ul
      %li accept a block as argument
      %li
        yield a
        %code Config
        instance to the given block
The way I did this in the
%a{:href =&gt; "http://twitter4r.rubyforge.org"} Twitter4R (open source Ruby library for the Twitter REST API)
project specifications was something like the following:
%pre
  :preserve
    
    describe Client, ".configure" do
      before(:each) do
        @has_yielded = false
        @block = Proc.new do |conf|
          conf.is_a?(Config).should be_true
          @has_yielded = true
        end
      end
    
      it "should accept a block as argument" do
        lambda {
          Client.configure {}
        }.should_not raise_error
      end
    
      it "should yield a Config object to given block" do
        Client.configure(&amp;block)
        @has_yielded.should be_true
      end
    
      after(:each) do
        @has_yielded, @block = nil
      end
    end
What I would really like to do something like the following instead:
%pre
  :preserve
    
    describe Client, ".configure" do
      it "should accept a block as argument" do
        lambda {
          Client.configure {}
        }.should_not raise_error
      end
    
      it "should yield a Config object to given block" do
        lambda {
          Client.configure(&amp;spec_block(1))
        }.should yield_with(Config)
      end
    end
I haven't extended the
%code Proc
class to this point, but if/when I do I will post it to this blog and perhaps also to the RSpec mailing list.

If you have suggestions on how to improve the more manual way (the first RSpec code listing above), please do let me know.  I have not yet played around with inheritable describe blocks yet, but I have hunch that would DRY up some of the code for if needed for many contexts.

Alternatively if you have suggestions on how to improve the second RSpec code listing (directly above) to be more clear, please do let me know that too.  I realize the developers of RSpec don't want to have too many
%code #should_XXX
methods, so I am open to suggestions (since I also agree with that notion).
%b UPDATE:
I created a new feature request and dialog with RSpec developers at:
%a{:href =&gt; "http://rubyforge.org/tracker/?func=detail&amp;atid=3152&amp;aid=11949&amp;group_id=797"} [#11949]

        </article>
      </section>
    </div>
    <footer>
  <p>
    Copyright Â© 2006-2018 <a href="//susanpotter.net">Susan Potter</a>.
  </p>
  <p>
    This website is developed by <a href="//susanpotter.net">Susan Potter</a>.
  </p>
  <div id="rights">
    <a href="//susanpotter.net">Susan Potter</a> reserves all rights to the copy and intellectual rights that are presented on this website as original material to <a href="//susanpotter.net">Susan Potter</a>.
    Links: <a href="//susanpotter.net/resume/software-engineering/">Software Engineer Extraordinaire</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Software Developer Extraordinaire</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Software Engineer</a>,
           <a href="//susanpotter.net/resume/architect/">Application architect/</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Ruby Software Engineer</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Ruby Engineer</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Ruby on Rails Engineer</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Ruby on Rails Software Engineer</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Software Developer</a>,
           <a href="//susanpotter.net/resume/architect/">Software architect/</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Hedge Fund Software Engineer</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Hedge Fund Software Developer</a>,
           <a href="//susanpotter.net/">Web Services Software Engineer</a>,
           <a href="//susanpotter.net/">Web Services Software Developer</a>,
           <a href="//susanpotter.net/">Web Services Engineer</a>,
           <a href="//susanpotter.net/">Web Services Developer</a>,
           <a href="//susanpotter.net/resume/restful-design/">REST Software Engineer</a>,
           <a href="//susanpotter.net/resume/restful-design/">REST Software Developer</a>,
           <a href="//susanpotter.net/resume/restful-design/">Resource Oriented architect/ure</a>,
  </div>
  <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-837842-1', 'auto');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');
  </script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.6/jquery.min.js"></script>
  
  
  <script async="async" defer src="/javascripts/app.js"></script>
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>
</footer>

    <script type="text/javascript">
      (function($) {
        var btns = $('.share-buttons .plusone').html('<g:plusone size="tall"></g:plusone>');
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })(jQuery);
    </script>
    <!-- Place this tag just before your close body tag -->
  

