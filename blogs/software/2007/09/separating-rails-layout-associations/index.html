

  
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link href="/images/favicon.ico" rel="shortcut icon">
  <title>Susan Potter: Separating Rails Layout Associations</title>
  <!--
  <link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap.css"/>
  -->
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="/stylesheets/styles.css">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6/jquery.min.js"></script>
  
  
  <script async="async" defer src="/javascripts/app.js"></script>
  <meta content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" name="viewport">
  <link rel="stylesheet" type="text/css" href="/stylesheets/coderay.css">


  
    <header>
  <div class="container">
    <a href="/">
      <img alt="Susan Potter" height="30" src="/images/logo.png" width="128">
    </a>
    <nav>
      <a href="/about/">About</a>
      <a href="/resume/">Resume</a>
      <a href="/portfolio/">Portfolio</a>
      <a href="/talks/">Talks</a>
      <a href="/contact/">Contact</a>
      <a target="_blank" id="twitter" class="icon" href="http://twitter.com/SusanPotter"><img src="/images/twitter.png" height="30" width="30" alt="@SusanPotter's Twitter feed"></a>
      <a target="_blank" id="linked" class="icon" href="http://www.linkedin.com/in/susanpotter"><img src="/images/linkedin.png" height="30" width="30" alt="Susan Potter's LinkedIn profile"></a>
      <a target="_blank" id="github" class="icon" href="https://github.com/mbbx6spp"><img src="/images/github.png" height="30" width="30" alt="Susan Potter's GitHub open source code repository profile"></a>
    </nav>
  </div>
</header>


    <div class="text post sidebar">
      <aside>
        <ul class="share-buttons">
          <li class="twitter"><a href="http://twitter.com/share" class="twitter-share-button" data-count="vertical" data-via="SusanPotter">Tweet</a></li>
          <li class="plusone">
          <!--
          <li class="linked"><script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-counter="top"></script></li>
          <li class="reddit"><script type="text/javascript" src="http://www.reddit.com/static/button/button2.js"></script></li>
          <li class="facebook"><iframe src="http://www.facebook.com/plugins/like.php?app_id=130334077058276&amp;send=false&amp;layout=box_count&amp;width=170&amp;show_faces=true&amp;action=like&amp;colorscheme=light&amp;font=lucida+grande&amp;height=90" scrolling="no" frameborder="0" style="text-align: right; border:none; overflow:hidden; width:170px; height:90px;" allowTransparency="true"></iframe></li>
          -->
        </ul>
      </aside>
      <section>
        <article>
          <h1 class="banner">
            Software Development Blog <small>(formerly called 'Snakes, Gems &amp; Coffee')</small>
            <span class="description">
              A technical blog with articles on a number of topics from Erlang, Ruby idioms, Javascript,
              semantic web, Rails tips, graph databases, distributed systems.
            </span>
          </h1>
          
          <h2>Separating Rails Layout Associations</h2>
          <h5 class="time">2007-09-13 19:16:00 -0700</h5>
          I just realized I hadn't shared this code yet on this blog.  I will also be including it in one of the
<a href="http://metafusion.rubyforge.org">metafusion</a>
subprojects (coming soon).  I've been using it when needed in my Rails projects on and off for the last several months.<h4>The Problem</h4>You have some controllers you include into your application from plugins or engines and you want to associate a particular layout to the plugin/engine controller from within your application (without changing anything in the plugin or engine - of course!).  There is not good way of doing this nicely in Rails presently as each controller usually defines controller-wide layouts within its definition.
<h4>The Solution</h4>
<pre>[finsignia/paths.rb]
<code>
# See:
# * Finsignia::Paths

# Contains helper methods related to paths and resolving modules and 
# classes from paths.  Provides for helpful mixin for various applications.
module Finsignia::Paths

  def self.included(base)
    base.extend ClassMethods
  end
  
  # Contains class methods for Finsignia::Paths mixin
  module ClassMethods
    @@element_postfixes = {:model =&gt; '', :controller =&gt; 'Controller'}

    def resolve_model(path)
      resolve_element :model, path
    end
  
    def resolve_controller(path)
      resolve_element :controller, path
    end
    
    def normalize_module_name(path)
      list = path.split('_')
      list.collect do |item|
        item.capitalize
      end.join
    end
    
    # Resolves path to a type of Rails element 
    # (e.g. model, controller, etc.).
    # 
    # Path refers to 'internal' path, NOT require path:
    #  'users/users' #=&gt; internal path
    #  'users/users_controller #=&gt; require path
    def resolve_element(type, path)
      first, rest = path.split('/')
      mod = ObjectSpace.const_get(normalize_module_name(first))
      while rest
        first, rest = rest.split('/')

        unless rest
          mod = mod.const_get(normalize_module_name("#{first}_#{@@element_postfixes[type].downcase}"))
        else
          mod = mod.const_get(normalize_module_name(first))
        end
        # I doubt this will ever get this far as per expeceted behavior of ObjectSpace and Module...so commented it out following unreachable line.
        #raise NameError.new("#{type} constant not found for internal path #{path}") unless mod
        return mod unless rest
      end      
    end
    
    # Separating this so we can stub this method out in specifications.
    def require_controller(path)
      require("#{path}_controller") unless "test" == ENV["RAILS_ENV"]
    end
    
    # Separating this so we can stub this method out in specifications.
    def require_model(path)
      require(path) unless "test" == ENV["RAILS_ENV"]
    end
  end
end




# See:
# * Finsignia::Layouts
# * Finsignia::LayoutsError

# Raised when an exceptional condition arises in the Layouts 
# mapping process.
class Finsignia::LayoutsError </code></pre>

        </article>
      </section>
    </div>
    <footer>
  <p>
    Copyright Â© 2006-2014 <a href="http://susanpotter.net">Susan Potter</a>.
  </p>
  <p>
    This website is developed by <a href="http://susanpotter.net">Susan Potter</a>.
  </p>
  <div id="rights">
    <a href="http://susanpotter.net">Susan Potter</a> reserves all rights to the copy and intellectual rights that are presented on this website as original material to <a href="http://susanpotter.net">Susan Potter</a>.
    Links: <a href="http://susanpotter.net/resume/software-engineering">Software Engineer Extraordinaire</a>,
           <a href="http://susanpotter.net/resume/software-engineering">Software Developer Extraordinaire</a>,
           <a href="http://susanpotter.net/resume/software-engineering">Software Engineer</a>,
           <a href="http://susanpotter.net/resume/architect">Application Architect</a>,
           <a href="http://susanpotter.net/resume/software-engineering">Ruby Software Engineer</a>,
           <a href="http://susanpotter.net/resume/software-engineering">Ruby Engineer</a>,
           <a href="http://susanpotter.net/resume/software-engineering">Ruby on Rails Engineer</a>,
           <a href="http://susanpotter.net/resume/software-engineering">Ruby on Rails Software Engineer</a>,
           <a href="http://susanpotter.net/resume/software-engineering">Software Developer</a>,
           <a href="http://susanpotter.net/resume/architect">Software Architect</a>,
           <a href="http://susanpotter.net/resume/software-engineering">Hedge Fund Software Engineer</a>,
           <a href="http://susanpotter.net/resume/software-engineering">Hedge Fund Software Developer</a>,
           <a href="http://susanpotter.net/">Web Services Software Engineer</a>,
           <a href="http://susanpotter.net/">Web Services Software Developer</a>,
           <a href="http://susanpotter.net/">Web Services Engineer</a>,
           <a href="http://susanpotter.net/">Web Services Developer</a>,
           <a href="http://susanpotter.net/resume/restful-design">REST Software Engineer</a>,
           <a href="http://susanpotter.net/resume/restful-design">REST Software Developer</a>,
           <a href="http://susanpotter.net/resume/restful-design">Resource Oriented Architecture</a>,
  </div>
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>
  <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-837842-1', 'auto');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');
  </script>
</footer>

    <script type="text/javascript">
      (function($) {
        var btns = $('.share-buttons .plusone').html('<g:plusone size="tall"></g:plusone>');
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })(jQuery);
    </script>
    <!-- Place this tag just before your close body tag -->
  

