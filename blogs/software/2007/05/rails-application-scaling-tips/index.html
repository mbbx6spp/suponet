

  
  <meta charset="utf-8"><meta http-equiv="content-type" content="text/html; charset=UTF-8"><link href="/images/favicon.ico" rel="shortcut icon"><title>Susan Potter: Rails Application Scaling Tips</title><!--
  <link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap.css"/>
  --><link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css"><link rel="stylesheet" type="text/css" href="/stylesheets/styles.css"><script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6/jquery.min.js"></script><script async="async" defer src="/javascripts/app.js"></script><meta content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" name="viewport"><link rel="stylesheet" type="text/css" href="/stylesheets/coderay.css"><header><div class="container">
    <a href="/">
      <img alt="Susan Potter" height="30" src="/images/logo.png" width="128"></a>
    <nav><a href="/about/">About</a>
      <a href="/resume/">Resume</a>
      <a href="/portfolio/">Portfolio</a>
      <a href="/talks/">Talks</a>
      <a href="/contact/">Contact</a>
      <a target="_blank" id="twitter" class="icon" href="http://twitter.com/SusanPotter"><img src="/images/twitter.png" height="30" width="30" alt="@SusanPotter's Twitter feed"></a>
      <a target="_blank" id="linked" class="icon" href="http://www.linkedin.com/in/susanpotter"><img src="/images/linkedin.png" height="30" width="30" alt="Susan Potter's LinkedIn profile"></a>
      <a target="_blank" id="github" class="icon" href="https://github.com/mbbx6spp"><img src="/images/github.png" height="30" width="30" alt="Susan Potter's GitHub open source code repository profile"></a>
    </nav>
</div>
</header><div class="text post sidebar">
      <aside><ul class="share-buttons">
<li class="twitter"><a href="http://twitter.com/share" class="twitter-share-button" data-count="vertical" data-via="SusanPotter">Tweet</a></li>
          <li class="plusone">
          <!--
          <li class="linked"><script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-counter="top"></script></li>
          <li class="reddit"><script type="text/javascript" src="http://www.reddit.com/static/button/button2.js"></script></li>
          <li class="facebook"><iframe src="http://www.facebook.com/plugins/like.php?app_id=130334077058276&amp;send=false&amp;layout=box_count&amp;width=170&amp;show_faces=true&amp;action=like&amp;colorscheme=light&amp;font=lucida+grande&amp;height=90" scrolling="no" frameborder="0" style="text-align: right; border:none; overflow:hidden; width:170px; height:90px;" allowTransparency="true"></iframe></li>
          -->
        </ul></aside><section><article><h1 class="banner">
            Software Development Blog <small>(formerly called 'Snakes, Gems &amp; Coffee')</small>
            <span class="description">
              A technical blog with articles on a number of topics from Erlang, Ruby idioms, Javascript,
              semantic web, Rails tips, graph databases, distributed systems.
            </span>
          </h1>
          
          <h2>Rails Application Scaling Tips</h2>
          <h3>2007-05-03 09:34:00 -0500</h3>
          This will be a howto on quickly enhancing performance, throughput or uptime of a Rails application:
<ul>
<li>
    Use
    <a href="http://www.danga.com/memcached/">memcached</a>
    for sessions
  </li>
  <li>Move static assets to separate lighttpd or httpd web server optimized for just static content</li>
  <li>
    Use more efficient templating engine such as
    <a href="http://www.kuwata-lab.com/erubis/">erubis</a>
  </li>
  <li>Use memcached for other high-frequency read AR models</li>
  <li>Configure Rails to cache pages, actions and fragments where relevant</li>
  <li>
    Use BackgrounDRB to delegate longer running tasks such as sending emails, etc.
    <em>Note:</em>
    This is out of date right now, I might recommend Cloud Crowd or other plugins at this point for background jobs or even using message oriented middleware (MOMs) like AMQP services like RabbitMQ.
  </li>
  <li>
    If your application requires a large number of concurrent large file uploads (say you are building the next YouTube) you should consider utilizing
    <a href="http://merb.rubyforge.org/files/README.html">Merb</a>.
    <em>Note:</em>
    this is also out of date since I wrote it in May 2007.
  </li>
</ul>At
this point you just need to focus on the standard scaling concerns:
<ul>
<li>database server tweaking (including database caching)</li>
  <li>removing unnecessary file system I/O</li>
  <li>removing unnecessary or consolidating network I/O</li>
  <li>Removing unnecessary computation or caching computational results where necessary</li>
  <li>etc.</li>
</ul>
<br><h4>Update (2010-08-15)</h4>
<p>The following tools/plugins can be used to optimize the how many and how much data is passed by the SQL queries generated by ActiveRecord:</p>
<ul>
<li>
    <a href="http://github.com/flyerhzm/bullet" target="_blank">Bullet</a>
    - helps you optimize your SQL queries by notifying you when not eager loading or using counter caches.
  </li>
  <li>
    <a href="http://github.com/methodmissing/scrooge" target="_blank">Scrooge</a>
    - SQL query optimizer which can reduce the amount of data getting sent from your database to your Rails application.
  </li>
  <li>
    <a href="http://github.com/brynary/rack-bug" target="_blank">Rack-bug</a>
    - reports stats about each request in development mode so you can see how many queries are being executed on each request (and a number of other useful request stats).
  </li>
</ul>
<br><p>For identifying memory bloat or leaks in the applications the following might be useful (when we have a need for such tools):</p>
<ul>
<li>
    <a href="http://github.com/binarylogic/memorylogic" target="_blank">Memorylogic</a>
    - logging memory usage.
  </li>
  <li>
    <a href="http://github.com/noahd1/oink" target="_blank">Oink</a>
    - for easily finding actions that significantly increase VM heap size.
  </li>
  <li>
    <a href="http://github.com/fauna/bleak_house" target="_blank">BleakHouse</a>
    - used this before for finding memory leaks in a Rails 1.2.3 app a couple of years back.  I believe it is working against Rails 2.3.4 apps now too.
  </li>
</ul>
<br><p>
  Also nesting includes on eager loading in ActiveRecord used to have memory leak implications.  I wrote about my experience in 2007 here:
  <a href="http://geek.susanpotter.net/2007/01/twas-night-before-launch.html" target="_blank">Twas the night before launch</a>.
</p>
<br><p>
  The memory leak from the
  <a href="http://geek.susanpotter.net/2007/01/twas-night-before-launch.html" target="_blank">Twas the night before launch</a>
  blog post may have been fixed in subsequent releases of ActiveRecord since July 2007 when I encountered it, in the case of nesting includes for eager loading in all one query, but the morale of the story is never assume that just because you are eager loading all in one query there aren't going to be other implications.
</p>

        </article></section>
</div>
    <footer><p>
    Copyright Â© 2006-2013 <a href="http://susanpotter.net">Susan Potter</a>.
  </p>
  <p>
    This website is developed by <a href="http://susanpotter.net">Susan Potter</a>.
  </p>
  <div id="rights">
    <a href="http://susanpotter.net">Susan Potter</a> reserves all rights to the copy and intellectual rights that are presented on this website as original material to <a href="http://susanpotter.net">Susan Potter</a>.
    Links: <a href="http://susanpotter.net/resume/software-engineer">Software Engineer Extraordinaire</a>,
           <a href="http://susanpotter.net/resume/developer">Software Developer Extraordinaire</a>,
           <a href="http://susanpotter.net/resume/software-engineer">Software Engineer</a>,
           <a href="http://susanpotter.net/resume/architect">Application Architect</a>,
           <a href="http://susanpotter.net/resume/software-engineer">Ruby Software Engineer</a>,
           <a href="http://susanpotter.net/resume/software-engineer">Ruby Engineer</a>,
           <a href="http://susanpotter.net/resume/software-engineer">Ruby on Rails Engineer</a>,
           <a href="http://susanpotter.net/resume/software-engineer">Ruby on Rails Software Engineer</a>,
           <a href="http://susanpotter.net/resume/developer">Software Developer</a>,
           <a href="http://susanpotter.net/resume/architect">Software Architect</a>,
           <a href="http://susanpotter.net/resume/software-engineer">Hedge Fund Software Engineer</a>,
           <a href="http://susanpotter.net/resume/developer">Hedge Fund Software Developer</a>,
           <a href="http://susanpotter.net/">Web Services Software Engineer</a>,
           <a href="http://susanpotter.net/">Web Services Software Developer</a>,
           <a href="http://susanpotter.net/">Web Services Engineer</a>,
           <a href="http://susanpotter.net/">Web Services Developer</a>,
           <a href="http://susanpotter.net/resume/restful-design">REST Software Engineer</a>,
           <a href="http://susanpotter.net/resume/restful-design">REST Software Developer</a>,
           <a href="http://susanpotter.net/resume/restful-design">Resource Oriented Architecture</a>,
  </div>
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script><script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-837842-1']);
    _gaq.push(['_trackPageview']);
    _gaq.push(['_setDetectFlash', false]);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script></footer><script type="text/javascript">
      (function($) {
        var btns = $('.share-buttons .plusone').html('<g:plusone size="tall"></g:plusone>');
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })(jQuery);
    </script><!-- Place this tag just before your close body tag -->