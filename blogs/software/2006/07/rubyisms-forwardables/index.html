

  
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link href="/images/favicon.ico" rel="shortcut icon">
  <meta content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" name="viewport">
  <title>Susan Potter: Rubyisms: forwardables</title>
  <link rel="stylesheet" type="text/css" href="/stylesheets/reset.css">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="/stylesheets/styles.css">
  <link rel="stylesheet" type="text/css" href="/stylesheets/coderay.css">


  
    <header>
  <div class="container">
    <a href="/">
      <img alt="Susan Potter" height="30" src="/images/logo.png" width="128">
    </a>
    <nav>
      <a href="/about/">About</a>
      <a href="/resume/">Resume</a>
      <a href="/portfolio/">Portfolio</a>
      <a href="/talks/">Talks</a>
      <a href="/contact/">Contact</a>
      <a target="_blank" id="twitter" class="icon" href="https://twitter.com/SusanPotter"><img src="/images/twitter.png" height="30" width="30" alt="@SusanPotter's Twitter feed"></a>
      <a target="_blank" id="linked" class="icon" href="https://www.linkedin.com/in/susanpotter"><img src="/images/linkedin.png" height="30" width="30" alt="Susan Potter's LinkedIn profile"></a>
      <a target="_blank" id="github" class="icon" href="https://github.com/mbbx6spp"><img src="/images/github.png" height="30" width="30" alt="Susan Potter's GitHub open source code repository profile"></a>
    </nav>
  </div>
</header>


    <div class="text post sidebar">
      <aside class=".hidden-xs .hidden-sm">
        <ul class="share-buttons">
          <li class="twitter"><a href="https://twitter.com/share" class="twitter-share-button" data-count="vertical" data-via="SusanPotter">Tweet</a></li>
          <li class="plusone">
          <li class="linked">
<script type="text/javascript" src="https://platform.linkedin.com/in.js"></script><script type="in/share" data-counter="top"></script>
</li>
        </ul>
      </aside>
      <section>
        <article>
          <h1 class="banner">
            Software Development Blog <small>(formerly called 'Snakes, Gems &amp; Coffee')</small>
            <span class="description">
              A technical blog with articles on a number of topics from Erlang, Ruby idioms, Javascript,
              semantic web, Rails tips, graph databases, distributed systems.
            </span>
          </h1>
          
          <h2>Rubyisms: forwardables</h2>
          <h5 class="time">2006-07-22 18:23:00 -0500</h5>
          %p
  Recently some Java friends of mine have decided to taste the juicier fruits in Ruby-land with my assistance.  So below are some excerpts from an email conversation I had with one about Ruby's standard library
  %code{:class =&gt; "language-ruby"} forwardable
  features:
%blockquote
  %p
    Suppose we have the following model classes defined for a simple CRM system: Customer, Address, PhoneNumber, Name, etc.  Now in Java-land we would have written something that looks like the following Ruby code (except you must type about a hundred more lines - although now you can write annotations to automate basic things like generate getters and setters or the like, which still requires a ridiculous amount of code to accomplish):
  %pre
    %code{:class =&gt; "language-ruby"}
      Name = Struct.new(:first_name, :last_name, :suffix, :salutation)
      Address = Struct.new(:street_address, :suite, :city, :state, :country, :zip)
      PhoneNumber = Struct.new(:country_code, :area_code, :exchange, :number, :extension)
      
      class Customer
      attr_accessor :name, :address, :phone_number
      end
  %small
    Note: the attr_accessor will create getters and setters for Ruby newbies.
  %p
    The problem is that you are not sure when you first design this if it will support future product offerings for business customers, which means the way we have modeled our simple CRM above may not support a business customer as well as individual customers.  However, as good agile developers we know better than to pre-empt future requirements by modeling the world up-front, so we stick with our current implementation for this next iteration/release.  To help us with future changes (even though we do not know what they will be or try to pre-empt them) we want to be able to access details directly from the
    %code{:class =&gt; "language-ruby"} Customer
    object to reduce coupling of clients of our
    %code{:class =&gt; "language-ruby"} Customer
    model.  This also helps us implicitly adhere to the
    = succeed "." do
      %a{:href =&gt; "http://c2.com/cgi/wiki?LawOfDemeter"} Law of Demeter
    A naive approach would be to manually create accessor methods for the
    = succeed "," do
      %code{:class =&gt; "language-ruby"} Address
    %code Name
    and
    %code{:class =&gt; "language-ruby"} PhoneNumber
    attributes in the
    %code{:class =&gt; "language-ruby"} Customer
    class.  But remember, this is Ruby-land, which is a magical place, so we can just do the following:
  %pre
    %code{:class =&gt; "language-ruby"}
      require 'forwardable'
      
      NAME_FIELDS = [:first_name, :last_name, :suffix, :salutation]
      ADDRESS_FIELDS = [:street_address, :suite, :city, :state, :country, :zip]
      PHONE_NUMBER_FIELDS = [:country_code, :area_code, :exchange, :number, :extension]
      
      Name = Struct.new(*NAME_FIELDS)
      Address = Struct.new(*ADDRESS_FIELDS)
      PhoneNumber = Struct.new(*PHONE_NUMBER_FIELDS)
      
      class Customer
      extend Forwardable
      attr_accessors :name, :address, :phone_number
      def_delegators :@name, *NAME_FIELDS
      def_delegators :@address, *ADDRESS_FIELDS
      def_delegators :@phone_number, *PHONE_NUMBER_FIELDS
      def initialize(name, address, phone_number)
      @name, @address, @phone_number = name, address, phone_number
      end
      end
  %p
    One of the many fantastic things about Ruby (and Python) is we have
    %code{:class =&gt; "language-ruby"} irb
    Ruby's interactive shell to prototype with.  So we open up a
    %code{:class =&gt; "language-ruby"} irb
    shell and do the following:
  %pre
    %code{:class =&gt; "language-ruby"}
      irb&gt; require 'FILE_WITH_ABOVE_CODE_IN'
      irb&gt; john_adams = Customer.new(Name.new('John', 'Adams', nil, 'Former President'), Address.new('101 Constabulary Road', nil, 'Bay Colony', 'MA', 'US', '000000'), nil) # remember phones didn't exist in the mid-18th Century!
      \=&gt; #&lt;Customer:0xb7f2be30 @address=#&lt;struct Address street_address="101 Constabulary Road", suite=nil, city="Bay Colony", state="MA", country="US", zip="000000"&gt;, @name=#&lt;struct Name first_name="John", last_name="Adams", suffix=nil, salutation="Former President"&gt;, @phone_number=nil&gt;
      irb&gt; john_adams.salutation
      \=&gt; "Former President"
      irb&gt; john_adams.state
      \=&gt; "MA"
      irb&gt; john_adams.street_address
      \=&gt; "101 Constabulary Road"
  %p Javahead&gt;&gt;&gt; We are still passing in the Name, Address and PhoneNumber stucts to create the Customer object in the first place, so why would flattening out the Customer interface reduce coupling?
  %p
    Great question [Javahead]!  In general, most applications will read data from models much more than create them, and quite a number of applications do not actually initially create any of the data, they simply massage it.  Now I am not suggesting that there are no applications that would create model objects more than read from them, but most likely your application will be 80% reading and 20% writing (including creating and updating).  So if we were to change the underlying structure of the Customer, on average 80% of the code that uses the Customer object would not know about its constituents and would not need to be changed.
%p
  Of course, this is somewhat of a contrived example, but I hope it shows how elegant, concise, simple, and yet powerful Rubyisms can be.

        </article>
      </section>
    </div>
    <footer>
  <p>
    Copyright Â© 2006-2018 <a href="//susanpotter.net">Susan Potter</a>.
  </p>
  <p>
    This website is developed by <a href="//susanpotter.net">Susan Potter</a>.
  </p>
  <div id="rights">
    <a href="//susanpotter.net">Susan Potter</a> reserves all rights to the copy and intellectual rights that are presented on this website as original material to <a href="//susanpotter.net">Susan Potter</a>.
    Links: <a href="//susanpotter.net/resume/software-engineering/">Software Engineer Extraordinaire</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Software Developer Extraordinaire</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Software Engineer</a>,
           <a href="//susanpotter.net/resume/architect/">Application architect/</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Ruby Software Engineer</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Ruby Engineer</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Ruby on Rails Engineer</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Ruby on Rails Software Engineer</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Software Developer</a>,
           <a href="//susanpotter.net/resume/architect/">Software architect/</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Hedge Fund Software Engineer</a>,
           <a href="//susanpotter.net/resume/software-engineering/">Hedge Fund Software Developer</a>,
           <a href="//susanpotter.net/">Web Services Software Engineer</a>,
           <a href="//susanpotter.net/">Web Services Software Developer</a>,
           <a href="//susanpotter.net/">Web Services Engineer</a>,
           <a href="//susanpotter.net/">Web Services Developer</a>,
           <a href="//susanpotter.net/resume/restful-design/">REST Software Engineer</a>,
           <a href="//susanpotter.net/resume/restful-design/">REST Software Developer</a>,
           <a href="//susanpotter.net/resume/restful-design/">Resource Oriented architect/ure</a>,
  </div>
  <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-837842-1', 'auto');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');
  </script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.6/jquery.min.js"></script>
  
  
  <script async="async" defer src="/javascripts/app.js"></script>
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>
</footer>

    <script type="text/javascript">
      (function($) {
        var btns = $('.share-buttons .plusone').html('<g:plusone size="tall"></g:plusone>');
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })(jQuery);
    </script>
    <!-- Place this tag just before your close body tag -->
  

