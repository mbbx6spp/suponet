

  
  <meta charset="utf-8"><meta http-equiv="content-type" content="text/html; charset=UTF-8"><link href="/images/favicon.ico" rel="shortcut icon"><title>Susan Potter: How Erlang Slays Zombies</title><!--
  <link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap.css"/>
  --><link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css"><link rel="stylesheet" type="text/css" href="/stylesheets/styles.css"><script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6/jquery.min.js"></script><script async="async" defer src="/javascripts/app.js"></script><meta content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" name="viewport"><link rel="stylesheet" type="text/css" href="/stylesheets/coderay.css"><header><div class="container">
    <a href="/">
      <img alt="Susan Potter" height="30" src="/images/logo.png" width="128"></a>
    <nav><a href="/about/">About</a>
      <a href="/resume/">Resume</a>
      <a href="/portfolio/">Portfolio</a>
      <a href="/talks/">Talks</a>
      <a href="/contact/">Contact</a>
      <a target="_blank" id="twitter" class="icon" href="http://twitter.com/SusanPotter"><img src="/images/twitter.png" height="30" width="30" alt="@SusanPotter's Twitter feed"></a>
      <a target="_blank" id="linked" class="icon" href="http://www.linkedin.com/in/susanpotter"><img src="/images/linkedin.png" height="30" width="30" alt="Susan Potter's LinkedIn profile"></a>
      <a target="_blank" id="github" class="icon" href="https://github.com/mbbx6spp"><img src="/images/github.png" height="30" width="30" alt="Susan Potter's GitHub open source code repository profile"></a>
    </nav>
</div>
</header><div class="text post sidebar">
      <aside><ul class="share-buttons">
<li class="twitter"><a href="http://twitter.com/share" class="twitter-share-button" data-count="vertical" data-via="SusanPotter">Tweet</a></li>
          <li class="plusone">
          <!--
          <li class="linked"><script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-counter="top"></script></li>
          <li class="reddit"><script type="text/javascript" src="http://www.reddit.com/static/button/button2.js"></script></li>
          <li class="facebook"><iframe src="http://www.facebook.com/plugins/like.php?app_id=130334077058276&amp;send=false&amp;layout=box_count&amp;width=170&amp;show_faces=true&amp;action=like&amp;colorscheme=light&amp;font=lucida+grande&amp;height=90" scrolling="no" frameborder="0" style="text-align: right; border:none; overflow:hidden; width:170px; height:90px;" allowTransparency="true"></iframe></li>
          -->
        </ul></aside><section><article><h1 class="banner">
            Software Development Blog <small>(formerly called 'Snakes, Gems &amp; Coffee')</small>
            <span class="description">
              A technical blog with articles on a number of topics from Erlang, Ruby idioms, Javascript,
              semantic web, Rails tips, graph databases, distributed systems.
            </span>
          </h1>
          
          <h2>How Erlang Slays Zombies</h2>
          <h5 class="time">2013-10-06 20:31:00 -0500</h5>
          <p>
  At Chicago Erlang Factory Lite last Friday (Oct 4, 2013), I gave a talk on
  what functional programming (and declarative style) taught me when I first
  started using Erlang/OTP at work a few years ago.
</p>
<p>
  At the end someone asked about whether, like in his experience with XSLT,
  Erlang codebases could start accruing "zombie" code that no longer, or
  never gets invoked.
</p>
<p>
  My answer wasn't fantastic upon reflection so I wanted to elaborate on
  the tooling available in the Erlang ecosystem to address all the types of
  "zombie" code.
</p>
<h3>The Weak Zombies</h3>
<p>
  When we write code in Erlang we either export the function for other
  modules to use or use only internally in the module. Or we don't use it at
  all. If we don't export it, the Erlang compiler will report this as a
  warning by default. Let's have a look at an example.
</p>
<pre><code class="erlang">$ erl
Erlang R16B02 (erts-5.10.3) [source] [64-bit] [smp:8:8] [async-threads:10] [hipe] [kernel-poll:false] [
dtrace]
Eshell V5.10.3  (abort with ^G)
1&gt; c(zombie_part1).
zombie_part1.erl:11: Warning: function weak_zombie/0 is unused
{ok,zombie_part1}
2&gt;</code></pre>
<p>
  As you can see here just compiling the Erlang source with default options
  will warn you that the function <code>weak_zombie/0</code> in the
  <code>zombie_part1</code> module is unused so you can clean it up.
</p>
<p>
  I don't believe this is the kind of zombie that the person that asked the
  question really had in mind, so let's keep going.
</p>
<h3>Ambiguous Zombies</h3>
<p>
  Now let's say that this was an exported function of a module that could
  get used by your own project and other projects that may depend on your
  project. Well, there is no great way to tell in this case since you
  would need to know how other projects are using your exported functions to
  know. This boils down to designing your software for others to consume
  well and avoiding adding features where there isn't a warranted use case.
</p>
<p>
  Of course, in the simple case where your project's code cannot be used
  as a dependency by other projects, we can use the <code>cover</code>
  module in the standard library. It's a coverage analysis tool for Erlang.
  Let's look below.
</p>
<pre><code class="erlang">Erlang R16B02 (erts-5.10.3) [source] [64-bit] [smp:8:8] [async-threads:10] [hipe] [kernel-poll:false] [dtrace]
Eshell V5.10.3  (abort with ^G)
1&gt; {ok, Pid} = cover:start().
{ok,}
2&gt; cover:compile_module(zombie_part1).
<!-- path/to/zombie_part1.erl:13: Warning: function weak_zombie/1 is unused -->
{ok,zombie_part1}
3&gt; c(zombie_caller).
{ok,zombie_caller}
4&gt; zombie_caller:main(["Joe", "John", "Joan", "Josephine"]).
{ok,["John","Joan","Josephine"]}
5&gt; cover:analyse(zombie_part1).
{ok,[{{zombie_part1,yo,1},{1,1}},
{{zombie_part1,weak_zombie,1},{0,1}}]}
6&gt; cover:stop().
ok</code></pre>
<p>
  Let's take a peak at what just happened here. First we ran <code>zombie_caller:main/1</code>
  which called functions in <code>zombie_part1</code> module to see what got
  called and what didn't. So that means you need <em>driver</em> code. Not
  a test suite with good code coverage (unless you curate your test suite
  VERY well, which I have yet to see in practice on larger codebases), but
  representative production code that hits all or the vast majority of your
  application's code to be able to tell where your codebase may have more
  exported functions than needed. Maybe in the case of a service of some
  kind that might be running the <code>main</code> entry point and then
  running exhaustive, representative client requests in a separate OS
  process. This might run for a few minutes or all day, or even all week.
</p>
<p>
  So what else can we see from the above snippet. Well what is returned from
  <code>code:analyse/1</code> is something of the following type:
</p>
<pre><code class="erlang"></code>
{ok, [{{Module :: atom, Function :: atom, Arity :: integer()},
{Cov ::integer(), NonCov :: integer()}}]}</pre>
<p>
  By default (unless you tell it otherwise) <code>cover:analyse</code> will
  provide functional level coverage information. You can request clause
  level of granularity, as well as line level detail.
</p>
<p>
  The Erlang documentation is actually really great for cover.
</p>
<h3>More Resistant Zombies</h3>
<p>
  Now let's say that we have the following scenario where we added a clause
  for a function which we planned to use, maybe we did use it for a while,
  but realized something else would be better, but we didn't clean up the
  clause when we were done. Let's illustrate this with a watered down
  example:
</p>
<p>
  TODO
</p>

        </article></section>
</div>
    <footer><p>
    Copyright Â© 2006-2013 <a href="http://susanpotter.net">Susan Potter</a>.
  </p>
  <p>
    This website is developed by <a href="http://susanpotter.net">Susan Potter</a>.
  </p>
  <div id="rights">
    <a href="http://susanpotter.net">Susan Potter</a> reserves all rights to the copy and intellectual rights that are presented on this website as original material to <a href="http://susanpotter.net">Susan Potter</a>.
    Links: <a href="http://susanpotter.net/resume/software-engineer">Software Engineer Extraordinaire</a>,
           <a href="http://susanpotter.net/resume/developer">Software Developer Extraordinaire</a>,
           <a href="http://susanpotter.net/resume/software-engineer">Software Engineer</a>,
           <a href="http://susanpotter.net/resume/architect">Application Architect</a>,
           <a href="http://susanpotter.net/resume/software-engineer">Ruby Software Engineer</a>,
           <a href="http://susanpotter.net/resume/software-engineer">Ruby Engineer</a>,
           <a href="http://susanpotter.net/resume/software-engineer">Ruby on Rails Engineer</a>,
           <a href="http://susanpotter.net/resume/software-engineer">Ruby on Rails Software Engineer</a>,
           <a href="http://susanpotter.net/resume/developer">Software Developer</a>,
           <a href="http://susanpotter.net/resume/architect">Software Architect</a>,
           <a href="http://susanpotter.net/resume/software-engineer">Hedge Fund Software Engineer</a>,
           <a href="http://susanpotter.net/resume/developer">Hedge Fund Software Developer</a>,
           <a href="http://susanpotter.net/">Web Services Software Engineer</a>,
           <a href="http://susanpotter.net/">Web Services Software Developer</a>,
           <a href="http://susanpotter.net/">Web Services Engineer</a>,
           <a href="http://susanpotter.net/">Web Services Developer</a>,
           <a href="http://susanpotter.net/resume/restful-design">REST Software Engineer</a>,
           <a href="http://susanpotter.net/resume/restful-design">REST Software Developer</a>,
           <a href="http://susanpotter.net/resume/restful-design">Resource Oriented Architecture</a>,
  </div>
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script><script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-837842-1']);
    _gaq.push(['_trackPageview']);
    _gaq.push(['_setDetectFlash', false]);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script></footer><script type="text/javascript">
      (function($) {
        var btns = $('.share-buttons .plusone').html('<g:plusone size="tall"></g:plusone>');
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })(jQuery);
    </script><!-- Place this tag just before your close body tag -->